{% extends 'base.html' %}

{% block title %}Inventario | Licorería Premium{% endblock %}

{% block extra_css %}
<style>
    .stock-badge {
        padding: 4px 10px;
        border-radius: 20px;
        font-size: 0.8rem;
        font-weight: 600;
    }

    .stock-low {
        background: rgba(239, 68, 68, 0.1);
        color: #ef4444;
        border: 1px solid rgba(239, 68, 68, 0.2);
    }

    .stock-ok {
        background: rgba(16, 185, 129, 0.1);
        color: #10b981;
        border: 1px solid rgba(16, 185, 129, 0.2);
    }

    .stock-ok {
        background: rgba(16, 185, 129, 0.1);
        color: #10b981;
        border: 1px solid rgba(16, 185, 129, 0.2);
    }
</style>
{% endblock %}

{% block content %}
<div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 2.5rem;">
    <div>
        <h2 style="margin: 0;"><i class="ph ph-beer-bottle" style="color: var(--accent);"></i> Gestión de Licores</h2>
        <p style="color: var(--text-secondary); margin: 5px 0 0 0;">Control de existencias e inventario físico</p>
    </div>
    <div style="display: flex; gap: 1rem;">

        <a href="{% url 'importar_licores' %}" class="btn btn-secondary">
            <i class="ph ph-sparkle"></i> Importación Pro
        </a>
        <button onclick="history.back()" class="btn btn-secondary">← Volver</button>
    </div>
</div>

<div class="card">
    <table style="width: 100%;">
        <thead>
            <tr>
                <th>Producto</th>
                <th>Categoría</th>
                <th>Precio</th>
                <th>Stock</th>
                <th style="text-align: right;">Acciones</th>
            </tr>
        </thead>
        <tbody>
            {% for producto in productos %}
            <tr>
                <td>
                    <div style="display: flex; align-items: center; gap: 15px;">
                        {% if producto.imagen %}
                        <img src="{{ producto.imagen.url }}"
                            style="width: 45px; height: 45px; object-fit: cover; border-radius: 10px;">
                        {% else %}
                        <div
                            style="width: 45px; height: 45px; background: rgba(255,255,255,0.05); border-radius: 10px; display: flex; align-items: center; justify-content: center;">
                            <i class="ph ph-beer-bottle" style="color: var(--text-secondary);"></i>
                        </div>
                        {% endif %}
                        <div>
                            <div style="font-weight: 600; color: white;">{{ producto.nombre }}</div>
                            <div style="font-size: 0.8rem; color: var(--text-secondary);">
                                {% if producto.marca %}{{ producto.marca }}{% else %}Sin Marca{% endif %}
                            </div>
                        </div>
                    </div>
                </td>
                <td>
                    <span class="tag">
                        {% if producto.categoria %}{{ producto.categoria.nombre }}{% else %}Sin Categoría{% endif %}
                    </span>
                </td>
                <td style="font-weight: 700; color: white;">${{ producto.precio|floatformat:2 }}</td>
                <td>
                    {% if producto.stock < 10 %} <span class="stock-badge stock-low">
                        <i class="ph ph-warning"></i> {{ producto.stock }}
                        </span>
                        {% else %}
                        <span class="stock-badge stock-ok">
                            <i class="ph ph-check-circle"></i> {{ producto.stock }}
                        </span>
                        {% endif %}
                </td>
                <td>
                    <div style="display: flex; gap: 8px; justify-content: flex-end;">
                        <button data-id="{{ producto.id }}" data-nombre="{{ producto.nombre }}"
                            onclick="abrirModalStock(this)" class="btn btn-primary"
                            style="padding: 6px 12px; font-size: 0.8rem;">
                            <i class="ph ph-plus-minus"></i> Stock
                        </button>
                        <a href="{% url 'producto_editar' producto.id %}" class="btn btn-secondary"
                            style="padding: 6px 12px; font-size: 0.8rem;">
                            <i class="ph ph-pencil"></i>
                        </a>
                        <a href="{% url 'producto_eliminar' producto.id %}" class="btn btn-danger"
                            style="padding: 6px 12px; font-size: 0.8rem;">
                            <i class="ph ph-trash"></i>
                        </a>
                    </div>
                </td>
            </tr>
            {% empty %}
            <tr>
                <td colspan="5" style="text-align: center; padding: 4rem; color: var(--text-secondary);">
                    No hay productos en el inventario.
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>

<!-- Modal Actualizar Stock (Usando sistema global) -->
<div id="modalStock" class="modal">
    <div class="modal-content">
        <i class="ph ph-x modal-close" onclick="closeModal('modalStock')"></i>

        <h3 style="margin: 0 0 0.5rem 0;">Actualizar Inventario</h3>
        <p id="prodNombre"
            style="color: var(--accent-primary); font-weight: 700; font-size: 1.1rem; margin-bottom: 2rem;"></p>

        <form id="formStock" method="POST">
            {% csrf_token %}
            <div style="display: flex; flex-direction: column; gap: 1.5rem;">
                <div>
                    <label>Cantidad a añadir/quitar:</label>
                    <input type="number" name="cantidad" class="form-control" required placeholder="Ej: 10 o -5">
                </div>
                <div>
                    <label>Motivo del ajuste:</label>
                    <input type="text" name="motivo" class="form-control" required
                        placeholder="Ej: Compra, Merma, Rotura">
                </div>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; margin-top: 1rem;">
                    <button type="submit" class="btn btn-primary" style="justify-content: center;">Confirmar</button>
                    <button type="button" onclick="closeModal('modalStock')" class="btn btn-secondary"
                        style="justify-content: center;">Cancelar</button>
                </div>
            </div>
        </form>
    </div>
</div>

<script>
    function abrirModalStock(btn) {
        const id = btn.getAttribute('data-id');
        const nombre = btn.getAttribute('data-nombre');
        document.getElementById('prodNombre').textContent = nombre;
        document.getElementById('formStock').action = `/gestion/productos/stock/licor/${id}/`;
        openModal('modalStock');
    }
</script>
{% endblock %}